## jwt 로그인 유지에 대해서...

구글링을 한참 했다.  
jwt 토큰의 개념은 많이 나오는데 실제 코드로 내 프로젝트에 응용하는 게 어려웠다.  
원래 개념이랑 원리만 알면 실제 프로젝트에서의 응용은 레퍼런스 찾아보기만 하면 되니까 쉽다고 생각했는데 그게 아니더라..  
레퍼런스 찾는 게 어렵더라..

레퍼런스를 어딘가에서 찾았다해도 내 프로젝트 맞춤 코드가 아니니깐 좀 변형해야 하는데,  
내 프로젝트에 맞게 변형하기 위해선 어떻게 된 코드인지 이해해야 한다. 물론 jwt를 통한 로그인 유지가 어떻게 돌아가는지 개념과 원리도 알고 있어야 한다.  
서치를 꽤 오래 했어서 난 어느 정돈 알고 있는 것 같다. (프론트 리액트의 입장에서 보면)
1. 로그인 요청하면 `accessToken`, `refreshToken`, 토큰 만료시간 리턴받는다.
2. 새로고침해도 안 날라가게 이 토큰들을 어디다 잘 저장해둔다. (여기서 어디란 localStorage? 근데 보안상 안 좋다고 함. 근데 테스트하기엔 이게 젤 간단한 듯)
3. 여기서 말하는 로그인 유지란 잘 저장해둔 `accessToken`, `refreshToken`으로 토큰 갱신해달라고 reissue 요청을 보내서 로그인 정보를 계속 갖고있는 것이다.  
로그인 정보란 요청보낸 `accessToken`, `refreshToken`을 가지고 이 토큰이 유효한지에 대한 정보를 말하는 것 같다.  
(별개로, 사용자의 개인정보 ex. email, nickname 도 새로고침해도 날라가지 않게 저장해둬야 0:비회원 1:손님 2:사장 3:관리자 권한에 따른 라우팅을 할 수 있을 것 같다.)  
*로그인을 유지하기 위해선 지속적으로 reissue 요청을 보내야 한다. 근데 그 요청을 언제 보내야 하는가가 문제다.*
4. 일단 컴포넌트가 처음 렌더링될 때마다 reissue 요청을 보내도록 한다. (useEffect, [])  
(setTimeout으로 토큰이 만료되기 1분 전에 reissue 요청 보내도록 설정하는 것도 있다.)

- `accessToken`이 만료되면 로그인을 유지할 수 있는 정보가 없어지므로 갱신해줘야 한다. 이때 `refreshToken`으로 갱신할 수 있다.
- `refreshToken`까지 만료되면? 그럼 어쩔 수 없이 로그인을 유지할 수 있는 정보는 다시 받을 수 없는 거다.

내가 이해한 게 맞나 싶다..  
구글링 이외에 유튜브에서도 찾아보다가 좀 도움이 될 것 같은 레퍼런스를 가져왔다. [이거](https://github.com/gitdagray/react_jwt_auth/blob/main/src/components/Login.js)

보통 로그인하고 setAuth나 setUser해서 상태를 관리하나보다.

한편, `recoil` 같은 거는 전역 상태 관리 라이브러리로, 브라우저나 DB에 저장해두지 않는 이상 새로고침되면 사라질 것들이라 본다.  
그냥 브라우저나 DB에 저장되어있는 ex. 이메일이나 유저 이름을 화면에 띄울 때,  
전역 변수로 관리해서 컴포넌트 간 전달 없이 간편하게 모든 컴포넌트에서 전역으로 사용하기 위한 것인 듯하다.

다음에는 레퍼런스를 찾아보며 내 프로젝트에 적용하기 위해 적지 않은 시간을 투자해야 할 것 같다.
