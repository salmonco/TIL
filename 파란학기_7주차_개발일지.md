## 1. 활동 내용
- 회원관리, CRUD 페이지를 디자인에 맞게 구현함
- 지도 API와 채팅 기능이 화면에서 제대로 동작하도록 함
- 레이아웃을 데스크탑/모바일에 맞게 반응형으로 설계함
- *베타 테스트 진행 중*

## 2. 이슈
로그인 직후의 요청에 토큰값이 담기지 않는 이슈가 있었다.

**상황**  
로그인 직후 쿠키에 jwt 토큰을 저장하고 메인페이지로 자동으로 넘어가도록 했다. 그리고 넘어간 메인페이지에서 쿠키에 있는 토큰값을 빼내서 요청 헤더에 함께 담아서 보내는 상황이다.

**해결**  
로그인 직후 메인페이지로 넘어가고 자동으로 리로드를 시켜주면 요청 헤더에 토큰값이 제대로 담겨있는 것을 확인할 수 있었다.

하지만, 왜 로그인 직후 리로드를 해야 요청 헤더에 토큰값 반영되는지 원인을 찾지 못했다.  
한 가지 생각해볼 수 있던 건, 비동기 문제였다. 로그인 직후 토큰값이 쿠키에 저장되기도 전에 메인페이지로 이동해서 그 결과 토큰값이 반영되지 않은 것이 아닌가 하는 추측이 있었다.

이러한 이슈가 비동기 문제라면 해결할 수 있는 방법은 다음과 같다.
1. 자바스크립트의 async, await을 통해 쿠키에 토큰이 저장되는 코드가 완전히 실행을 마칠 때까지 기다려준 후에서야 메인페이지로 이동하도록 한다.
2. 혹은 메인페이지에서의 요청에 setTimeout을 통해 타이머를 걸어서, 토큰이 쿠키에 저장될 때까지 기다리는 시간을 벌기 위해 몇 초 후에 요청이 가도록 해준다.

비동기 문제와 관련해서는 더 고민해봐야 할 문제라고 생각했다.


또, 로그인 유지에 대한 이슈가 있었다.

**상황**  
브라우저가 종료되어도 로그인을 유지할 수 있게끔 하고 싶었다. 이에 쿠키에 만료시간을 설정함으로써 브라우저가 종료되어도 브라우저에 쿠키가 남아있게 되어, 다시 사이트에 접속했을 때 로그인이 유지될 수 있도록 하고자 했다.  
그런데 문제가, 토큰 두 개를 각각 만료시간을 줘서 똑같은 방법으로 저장했는데, 하나는 만료시간이 제대로 설정되어 있고, 하나는 만료시간이 자동으로 세션으로 바뀌었다. 세션 쿠키는 브라우저가 종료되면 삭제되는 쿠키이기 때문에 로그인을 유지할 수가 없게 된 상황이다.

**원인**  
쿠키의 만료시간을 너무 길게 설정하면 자동으로 세션 쿠키로 변환되었다. 이 때문에 하나의 쿠키만 만료시간을 19년으로 너무 길게 설정했던 것이 원인이었다.

**해결**  
쿠키의 만료시간을 적당하게 1년으로 설정하니 해결되었다.

## 3. 새로 배운 내용
- PerformanceNavigationTiming : 새로고침 감지  
레퍼런스 : https://stackoverflow.com/questions/70784027/how-to-get-check-if-a-page-gets-reloaded-with-js

- 세션 쿠키 vs 지속 쿠키 : 세션 쿠키는 쿠키에 만료시간을 설정해주지 않은 쿠키로, 삭제 시점은 브라우저가 종료되는 시점이다. 지속 쿠키는 쿠키에 만료시간을 설정한 쿠키로, 브라우저가 종료되어도 만료시간이 지나지 전까지 삭제되지 않는다.

- XSS 공격: 브라우저에 javascript를 삽입해서 스크립트가 실행되도록 함  
ex) 게시글 작성할 때 <script>alert(document.cookie)</script> 코드 작성해서 쿠키 탈취  
-> javascript 접근을 막는 식으로 방어 가능

- CSRF 공격: 사이트 간 요청 위조, 사용자 자신도 모르는 사이 위조 요청이 행해짐  
api를 요청하는 클라이언트의 도메인을 설정하지 않을 경우 발생할 수 있음  
-> refresh token만 브라우저에 저장해놓고 access token을 받아와 인증에 이용하는 식으로 방어 가능

- refresh token : secure httpOnly 쿠키에 저장 (javascript 접근 막을 수 있음 -> XSS 공격 방어 가능)
- access token : 로컬변수에 저장 (CSRF 공격 방어 가능)

## 4. 회고
버그 수정과 관련해서, 로그인 유지처럼 간단하게 해결할 수 있었던 이슈를 며칠째 해결하지 못해서 골머리를 앓았던 것은 좀 아쉽지만, 그러한 이슈들 덕분에 몰랐던 것을 또 하나 새롭게 배울 수 있었던 것 같아 좋았다.

한편, 베타 테스트를 진행함에 따라 버그 수정 빈도가 잦아졌다. 개발하면서 발견하지 못했던 버그들을 실제로 다른 사람에게 사용하도록 해봄으로써 예상치 못한 버그들을 발견할 수 있었다. 그리고 베타 테스트 진행을 위해 가게에 직접 방문해서 그 자리에서 사장님께 아리 사이트에 접속을 요청드리고 회원가입/로그인, 가게 정보 수정 등이 진행될 수 있도록 설명드렸다. 여름 방학부터 개발 팀원들과 꾸준히 스터디한 것을 바탕으로 웹 서비스를 만들어서, 직접 가게에 방문해 구현한 것의 기능을 설명드리니 그 자체로 뜻깊었던 것 같다. 베타 테스트란 것도 처음 해보는 경험인 만큼 미숙한 부분이 당연히 있겠지만, 좋은 성과를 만들기 위해 계속해서 성실히 임하고자 한다.

## 5. 향후 계획
- 공통적인 가게 탭 레이아웃 구성
- 정보 전달 위한 서버와 통신 및 데이터 가공
- *베타 테스트에서의 피드백 반영*
